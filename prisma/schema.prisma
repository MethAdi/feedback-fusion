// prisma/schema.prisma
// Define your database models

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
  
}

datasource db {
  provider = "postgresql"
}

// Example models

model User {
  id            Int     @id @default(autoincrement())
  clerkUserId   String  @unique
  email         String  @unique
  name          String?
  image         String
  posts         Post[]
  votes         Vote[]   
  comments     Comment[]
  role          Role   @default(user)

  @@map("users")

}

model Post {
  id               Int     @id @default(autoincrement())
  title              String
  description          String?
  category           String 
  status          PostStatus  @default(under_review)
  author             User    @relation(fields: [authorId], references: [id])
  authorId              Int
    votes        Vote[]
    comments     Comment[]
    createdAt        DateTime  @default(now())
    updatedAt        DateTime @updatedAt
    @@map("posts")

}

model Vote {
    id                      Int    @id @default(autoincrement())
    user                   User @relation(fields: [userId], references: [id])
    userId                Int  
    post                 Post @relation(fields: [postId], references: [id])
    postId              Int     

  @@unique([userId, postId])
  @@map("votes")

}


model Comment {
  id    Int   @id @default(autoincrement())
  content String
  post  Post @relation(fields: [postId], references: [id])
  postId Int
  authorId Int 
  author User @relation(fields: [authorId], references: [id])
  parentId Int? 
  parent Comment? @relation("CommentToComment", fields: [parentId], references: [id])
  replies Comment[] @relation("CommentToComment")


  createdAt DateTime @default(now())

}


enum Role {
    user
    admin
}
enum PostStatus {
    under_review
    planned
    in_progress
    live
}
